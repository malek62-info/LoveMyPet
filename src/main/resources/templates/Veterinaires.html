<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinary Map</title>
    <!-- Inclure les bibliothèques Leaflet, Bootstrap et le style personnalisé -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
    <style>
        body, html {
            height: 100%; /* Réduire la hauteur de la carte */
            margin: 0;
        }

        #map {
            height: 100%; /* Utilisez 100% de la hauteur visible de la fenêtre */
        }
    </style>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<!-- Menu en haut de la page -->
<div class="top-menu">
    <!-- Liens du menu -->
    <a href="#" onclick="searchVets()">Recherche</a>
    <a href="#" onclick="clearMap()">Ne rien afficher</a>
    <a href="#" onclick="closePage()">Quitter</a>
</div>

<!-- Div pour afficher la carte -->
<div id="map"></div>




<!-- Modal pour afficher les détails du vétérinaire -->
<div class="modal fade" id="vetDetailsModal" tabindex="-1" aria-labelledby="vetDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="vetDetailsModalLabel">Détails du vétérinaire</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="vetDetailsBody">
                <!-- Les détails du vétérinaire seront affichés ici -->
            </div>
        </div>
    </div>
</div>
<script>
    // Obtenir la position actuelle de l'utilisateur
    navigator.geolocation.getCurrentPosition(position => {
        const { latitude, longitude } = position.coords;

        // Initialiser la carte Leaflet
        const map = L.map('map').setView([latitude, longitude], 13);

        // Ajouter une couche de tuiles OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Appeler l'API Spring Boot avec les coordonnées de l'utilisateur
        fetch(`/api/veterinaires?latitude=${latitude}&longitude=${longitude}`)
            .then(response => response.json())
            .then(data => {
                const veterinaries = data.elements;

                // Ajouter un marqueur pour chaque vétérinaire sur la carte
                veterinaries.forEach(vet => {
                    const { tags, lat, lon } = vet;
                    const name = tags.name || 'Vétérinaire';

                    const marker = L.marker([lat, lon]).addTo(map);
                    marker.bindPopup(`<b>${name}</b><br>Coordonnées : ${lat}, ${lon}<br><a href="#" class="btn btn-primary" onclick="showVetDetails('${name}', '${lat}', '${lon}', '${tags.phone}', '${tags.website}')">Détails</a>`);
                });
            })
            .catch(error => {
                console.error(error);
                alert('Erreur lors de la récupération des informations sur les vétérinaires.');
            });
    }, error => {
        console.error(error);
        alert('Impossible d\'obtenir votre position actuelle.');
    });

    // Fonction pour gérer les actions de la carte en fonction de la sélection dans le menu déroulant
    function handleMapAction(action) {
        switch (action) {
            case 'searchVets':
                searchVets();
                break;
            case 'clearMap':
                clearMap();
                break;
            case 'closePage':
                closePage();
                break;
            default:
                break;
        }
    }

    // Fonction pour afficher les détails du vétérinaire dans une modal
    function showVetDetails(name, lat, lon, phone, website) {
        // Remplir le contenu de la modal avec les détails du vétérinaire
        const modalBody = document.getElementById('vetDetailsBody');
        modalBody.innerHTML = `
            <p><strong>Nom:</strong> ${name}</p>
            <p><strong>Téléphone:</strong> ${phone || 'Non disponible'}</p>
            <p><strong>Site Web:</strong> ${website || 'Non disponible'}</p>
        `;

        // Afficher la modal
        const modal = new bootstrap.Modal(document.getElementById('vetDetailsModal'));
        modal.show();
    }
</script>

<script src="https://unpkg.com/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
