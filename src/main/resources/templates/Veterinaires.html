<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinary Map</title>
    <!-- Inclure les bibliothèques Leaflet, Bootstrap et le style personnalisé -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
    <style>
        body, html {
            height: 100%; /* Réduire la hauteur de la carte */
            margin: 0;
        }

        #map {
            height: 100%; /* Utilisez 100% de la hauteur visible de la fenêtre */
            width: calc(100% - 150px); /* Largeur de la carte - 150px pour le menu à gauche */
            float: right; /* Aligner la carte à droite */
        }

        #sidebar {
            width: 150px;
            height: 100vh;
            padding: 20px;
            background-color: #343a40;
            color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        #sidebar h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        #sidebar a {
            text-decoration: none;
            color: #fff;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #sidebar a:hover {
            background-color: #495057;
        }
         .logo-img {
        max-width: 100%; /* Ajustez la largeur maximale selon vos besoins */
        height: auto; /* Pour maintenir les proportions du logo */
    }
    </style>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<!-- Div pour afficher la carte -->
<div id="map"></div>

<!-- Menu à gauche -->
<div id="sidebar">
    <h2><img src="images/logo.png" alt="Logo" class="logo-img" ></h2>

    <a href="#" >Recherche par ville</a>
    <a href="#" >périmètre de recherche</a>
    <a href="/Map">Nos services</a>
</div>

<!-- Modal pour afficher les détails du vétérinaire -->
<div class="modal fade" id="vetDetailsModal" tabindex="-1" aria-labelledby="vetDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="vetDetailsModalLabel">Détails du vétérinaire</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="vetDetailsBody">
                <!-- Les détails du vétérinaire seront affichés ici -->
            </div>
        </div>
    </div>
</div>

<script>
    // Obtenir la position actuelle de l'utilisateur
    navigator.geolocation.getCurrentPosition(position => {
        const { latitude, longitude } = position.coords;

        // Initialiser la carte Leaflet
        const map = L.map('map').setView([latitude, longitude], 13);

        // Ajouter une couche de tuiles OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Appeler l'API Spring Boot avec les coordonnées de l'utilisateur
        fetch(`/api/veterinaires?latitude=${latitude}&longitude=${longitude}`)
            .then(response => response.json())
            .then(data => {
                const veterinaries = data.elements;

                // Ajouter un marqueur pour chaque vétérinaire sur la carte
                veterinaries.forEach(vet => {
                    const { tags, lat, lon } = vet;
                    const name = tags.name || 'Vétérinaire';

                    const marker = L.marker([lat, lon]).addTo(map);
                    marker.bindPopup(`<b>${name}</b><br>Coordonnées : ${lat}, ${lon}<br><a href="#" class="btn btn-primary" onclick="showVetDetails('${name}', '${lat}', '${lon}', '${tags.phone}', '${tags.website}')">Détails</a>`);
                });
            })
            .catch(error => {
                console.error(error);
                alert('Erreur lors de la récupération des informations sur les vétérinaires.');
            });
    }, error => {
        console.error(error);
        alert('Impossible d\'obtenir votre position actuelle.');
    });

    function searchVets() {
        // Implémentez la fonction de recherche des vétérinaires
        alert('Recherche de vétérinaires');
    }

    function clearMap() {
        // Implémentez la fonction pour effacer la carte
        alert('Effacer la carte');
    }

    function closePage() {
        // Implémentez la fonction pour fermer la page
        alert('Fermer la page');
    }

    function showVetDetails(name, lat, lon, phone, website) {
        const modalBody = document.getElementById('vetDetailsBody');
        modalBody.innerHTML = `
            <p><strong>Nom:</strong> ${name}</p>
            <p><strong>Téléphone:</strong> ${phone || 'Non disponible'}</p>
            <p><strong>Site Web:</strong> ${website || 'Non disponible'}</p>
        `;

        const modal = new bootstrap.Modal(document.getElementById('vetDetailsModal'));
        modal.show();
    }
</script>

<script src="https://unpkg.com/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>