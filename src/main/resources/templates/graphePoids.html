<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historique Weight</title>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Include Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <link rel="stylesheet" href="/css/infoanimal.css">
    <!-- FONT AWESOME LINK USING BOXICON -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <script src="/script/navbar.js"></script>
</head>

<body>
    <div class="navbar-wrapper">
        <div class="navbar">
            <div class="logo">
                <img src="images/logo.png" style="width: 150px; height: 65px;">

            </div>
            <div class="nav_right">
                <ul>
                    <p>Bonjour <span id="userName"></span> !</p>
                    <li class="nr_li dd_main">
                        <img src="/images/person1.jpg" alt="profile_img">
                        <div class="dd_menu">
                            <div class="dd_left">
                                <ul>
                                    <li><i class="fa-solid fa-user"></i></li>
                                    <li><i class="fa-solid fa-paw"></i></li>
                                    <li><i class="fas fa-sign-out-alt"></i></li>
                                </ul>
                            </div>
                            <div class="dd_right">
                                <ul>
                                    <li><a href="/profile">Mon compte</a></li>
                                    <li><a href="/mesanimaux">Mes animaux</a></li>
                                    <li><a>Se DÃ©connecter</a></li>
                                    <li><a href="/mescandidatures">Mes candidatures</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <h1>Suivi du poids de mon animal</h1>
    <div class="container">
        <div>
            <!-- Ajoute des boutons pour chaque mois -->
            <button onclick="loadHistoriqueWeightDataByMonth(1)">January</button>
            <button onclick="loadHistoriqueWeightDataByMonth(2)">February</button>
            <button onclick="loadHistoriqueWeightDataByMonth(3)">March</button>
            <button onclick="loadHistoriqueWeightDataByMonth(4)">April</button>
            <button onclick="loadHistoriqueWeightDataByMonth(5)">May</button>
            <button onclick="loadHistoriqueWeightDataByMonth(6)">June</button>
            <button onclick="loadHistoriqueWeightDataByMonth(7)">July</button>
            <button onclick="loadHistoriqueWeightDataByMonth(8)">August</button>
            <button onclick="loadHistoriqueWeightDataByMonth(9)">September</button>
            <button onclick="loadHistoriqueWeightDataByMonth(10)">October</button>
            <button onclick="loadHistoriqueWeightDataByMonth(11)">November</button>
            <button onclick="loadHistoriqueWeightDataByMonth(12)">December</button>
        </div>
    </div>

    <div id="historiqueWeightChart"></div>

    <script>
        function getAnimalIdFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('id');
            }

        // Function to fetch and display historique weight data by month
        function loadHistoriqueWeightDataByMonth(month) {
            // Replace 1 with the actual animal ID
            const animalId = getAnimalIdFromUrl();
            $.ajax({
                url: "/historiqueWeight/data/" + animalId,
                method: "GET",
                success: function (data) {
                    // Filter data for the selected month
                    var filteredData = data.filter(function (historiqueWeight) {
                        return new Date(historiqueWeight.date).getMonth() + 1 === month; // Months are 0-indexed in JavaScript
                    });

                    displayHistoriqueWeightChart(filteredData);
                },
                error: function (error) {
                    console.error("Error fetching historique weight data:", error);
                }
            });
        }

        // Function to display historique weight data as a chart
        function displayHistoriqueWeightChart(data) {
            var formattedData = data.map(function (historiqueWeight) {
                return {
                    x: new Date(historiqueWeight.date).getTime(),
                    y: historiqueWeight.weight
                };
            });

            Highcharts.chart('historiqueWeightChart', {
                chart: {
                    type: 'line'
                },
                title: {
                    text: 'Historique du poids '
                },
                xAxis: {
                    type: 'datetime',
                    title: {
                        text: 'Date'
                    },
                    labels: {
                        formatter: function () {
                            return Highcharts.dateFormat('%Y-%m-%d', this.value);
                        }
                    }
                },
                yAxis: {
                    title: {
                        text: 'Poids'
                    }
                },
                series: [{
                    name: 'Weight',
                    data: formattedData,
                    marker: {
                        symbol: 'url(images/scale.png)', // Replace with the actual path to your image
                        width: 35, // Replace with the desired width
                        height: 35 // Replace with the desired height
                    }
                }]
            });
        }

        // Load data for the default month (e.g., January)
        loadHistoriqueWeightDataByMonth(1);
    </script>
    <script>
        var dd_main = document.querySelector(".dd_main");

        dd_main.addEventListener("click", function () {
            this.classList.toggle("active");
        })
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $.ajax({
                url: "/person/profile",
                type: "GET",
                success: function (data) {
                    var profileInfo = "ID : " + data.id + "<br>Nom : " + data.name;
                    $("#profileInfo").html(profileInfo);

                    $("#userName").text(data.name);
                },
                error: function (xhr, status, error) {
                }
            });
        });
    </script>
</body>

</html>