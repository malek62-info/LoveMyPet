<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donations</title>
    <link rel="stylesheet" href="css/donation.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/donation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jost:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            list-style: none;
            font-family: 'Jost', sans-serif;
        }


        .navbar {
            background: black;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 50px;
        }

        .navbar .logo a {
            display: block;
            text-decoration: none;
            color: #fff;
            font-weight: 700;
            letter-spacing: 2px;
            font-size: 25px;
            text-transform: uppercase;
        }

        .navbar .nav_right>ul {
            display: flex;
            align-items: center;
        }

        .nav_right p {
            color: #fff;
            font-weight: 600;
        }

        .navbar .nav_right ul li.nr_li {
            margin-left: 25px;
            cursor: pointer;
            color: #fff;
            font-size: 20px;
            position: relative;
        }

        .navbar .nav_right ul li.nr_li:hover {
            color: #cefffc;
        }

        .navbar .nav_right ul li img {
            width: 60px;
            vertical-align: middle;
            border-radius: 50%;
        }

        .navbar .dd_menu {
            position: absolute;
            right: -25px;
            top: 47px;
            display: flex;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.25);
            display: none;
            width: 280px;
        }

        .navbar .dd_menu .dd_left {
            background: #b4b4b2;
            padding: 15px 20px;
            border-top-left-radius: 15px;
            border-bottom-left-radius: 15px;
        }

        .navbar .dd_menu .dd_left li {
            color: #fff;
        }

        .navbar .dd_menu .dd_right {
            padding: 15px 20px;
        }

        .navbar .dd_menu li {
            margin-bottom: 10px;
            color: #868686;
        }

        .navbar .dd_menu:before {
            content: "";
            position: absolute;
            top: -20px;
            right: 30px;
            border: 10px solid;
            border-color: transparent transparent #fff transparent;
        }

        .navbar .dd_main.active .dd_menu {
            display: flex;
        }
    </style>




</head>

<body>
    <div class="navbar-wrapper">
        <div class="navbar">
            <div class="logo">
                <img src="images/logo.png" style="width: 150px; height: 65px;">

            </div>
            <div class="nav_right">
                <ul>
                    <p>Bonjour <span id="userName"></span> !</p>
                    <li class="nr_li dd_main">
                        <img src="/images/person1.jpg" alt="profile_img">
                        <div class="dd_menu">
                            <div class="dd_left">
                                <ul>
                                    <li><i class="fa-solid fa-user"></i></li>
                                    <li><i class="fa-solid fa-paw"></i></li>
                                    <li><i class="fas fa-sign-out-alt"></i></li>
                                </ul>
                            </div>
                            <div class="dd_right">
                                <ul>
                                    <li><a href="/profile">Mon compte</a></li>
                                    <li><a href="/mesanimaux">Mes animaux</a></li>
                                    <li><a href="#">Se D√©connecter</a></li>
                                    <li><a href="/mescandidatures">Mes candidatures</a></li>

                                </ul>
                            </div>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
    </div>




    <div class="wrapper">
        <div class="container">
            <div class="title">
                <h1>Mes donations</h1>
            </div>

            <div class="item">
                <div class="item-container" id="itemContainer">
                    <!-- Liste des objets ici -->
                </div>
                <div id="error-message"></div>
            </div>
        </div>
    </div>

    <script>

        window.onload = function ()
        {
            fetchData();
        };

        function toggleContact ( event )
        {
            const button = event.target;
            const itemItem = button.closest( '.item-item' );
            const contact = itemItem.querySelector( '.contact' );
            contact.classList.toggle( 'show' );

            // Change le texte du bouton en fonction de l'√©tat du contact
            if ( contact.classList.contains( 'show' ) ) {
                button.textContent = 'fermer';
            } else {
                button.textContent = 'afficher';
            }
        }

        async function fetchData() {
    try {
        // R√©cup√©rer l'ID de profil depuis l'API /person/profile
        const profileResponse = await fetch('/person/profile');
        const profileData = await profileResponse.json();

        // Utiliser l'ID r√©cup√©r√© pour construire l'URL de l'API /api/items-to-donate/person/{id}
        const listUrl = `/api/items-to-donate/person/${profileData.id}`;
        console.log(listUrl);

        // Appeler l'API /api/items-to-donate/person/{id}
        const response = await fetch(listUrl);

        if (response.status === 204) {
            // Le statut 204 indique qu'il n'y a pas de contenu
            document.getElementById('error-message').innerHTML =
                "<p class='message-error'>Vous n'avez poster aucun objet!</p>";
        } else if (response.status === 200) {
            // Le statut 200 indique que la requ√™te a r√©ussi et qu'il y a du contenu
            const data = await response.json();
            if (data.length > 0) {
                console.log('Inside if');
                for (const reference of data) {
                    await fetchItemDetails(reference);
                }
            }
        } else {
            // G√©rer d'autres statuts de r√©ponse si n√©cessaire
            console.error('Unexpected response status:', response.status);
        }

    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

        async function fetchItemDetails ( reference )
        {
            try {
                // Construire l'URL pour chaque objet
                const completeURL = `/api/items-to-donate${ reference }`;

                // Appeler l'API pour r√©cup√©rer les d√©tails de l'objet
                const response = await fetch( completeURL );
                const itemDetails = await response.json();

                // Afficher les d√©tails de l'objet
                displayItem( itemDetails );
            } catch ( error ) {
                console.error( `Error fetching object details for this URI ${ completeURL }:`, error );
            }
        }

        function displayItem ( itemDetails )
        {
            const itemContainerDiv = document.getElementById( 'itemContainer' );

            const itemHTML = `
        <div class="item-item">
            <div class="item-img">
                <img src="/images/items-to-donate/${ itemDetails.imageUrl }" alt="item image">
                <div>
                    <div class="add-btn" onclick="toggleContact(event)">contacts &#x1F600;</div>
                </div>
            </div>
            <div class="contact">
                <p>üôéüèªLe donateur</p>
                <span> üìß
                  <a href="mailto:${ itemDetails.donatingPerson.email }">${ itemDetails.donatingPerson.email }</a>
                </span>
                <span>üìû  ${ itemDetails.donatingPerson.phoneNumber }</span>
            </div>
            <div class="item-content">
                <a href="#" class="item-title">üî• ${ itemDetails.itemName } </a>
                <p class="race description"><span>‚ÑπÔ∏è ${ itemDetails.description }</span></p>
            </div>
        </div>
    `;

            itemContainerDiv.innerHTML += itemHTML;
        }

    </script>

</body>


</html>